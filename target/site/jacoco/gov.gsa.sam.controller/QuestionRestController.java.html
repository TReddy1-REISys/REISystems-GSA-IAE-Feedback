<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>QuestionRestController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Feedback Manager</a> &gt; <a href="index.source.html" class="el_package">gov.gsa.sam.controller</a> &gt; <span class="el_source">QuestionRestController.java</span></div><h1>QuestionRestController.java</h1><pre class="source lang-java linenums">package gov.gsa.sam.controller;

import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.linkTo;
import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.methodOn;

import java.util.ArrayList;
import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.hateoas.CollectionModel;
import org.springframework.hateoas.Link;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import gov.gsa.sam.domain.Question;
import gov.gsa.sam.exception.BaseApplicationException;
import gov.gsa.sam.service.QuestionService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.Parameters;
import io.swagger.v3.oas.annotations.enums.ParameterIn;
import io.swagger.v3.oas.annotations.tags.Tag;

/**
 * @author Nithin.Emanuel
 * 
 *         QuestionRestController
 *
 */
@RestController
@RequestMapping(value = FeedbackController.BASEPATH + &quot;/v1/question&quot;, produces = MediaType.APPLICATION_JSON_VALUE)
@Tag(name = &quot;Question&quot;, description = &quot;Question Operations&quot;)
<span class="fc" id="L42">public class QuestionRestController {</span>

<span class="fc" id="L44">	private static final Logger log = LoggerFactory.getLogger(QuestionRestController.class);</span>

	@Autowired
	private QuestionService quesService;

	/**
	 * This method is used to fetch all questions from QuestionService
	 * 
	 * @param qIds
	 * @return ResponseEntity&lt;CollectionModel&lt;Question&gt;&gt;
	 * @throws BaseApplicationException
	 */
	@RequestMapping(method = RequestMethod.GET)
	@Operation(description = &quot;Fetch all Questions&quot;)
	@Parameters({
			@Parameter(name = &quot;qIds&quot;, description = &quot;Filter questions by Ids (comma seperated Ids)&quot;, in = ParameterIn.QUERY),
			@Parameter(name = &quot;status&quot;, description = &quot;Filter questions by status&quot;, in = ParameterIn.QUERY) })
	public ResponseEntity&lt;CollectionModel&lt;Question&gt;&gt; getQuestions(
			@RequestParam(value = &quot;qIds&quot;, required = false) String qIds,
			@RequestParam(value = &quot;status&quot;, required = false) String status) throws BaseApplicationException {
<span class="fc" id="L64">		List&lt;Question&gt; allQuestions = new ArrayList&lt;Question&gt;();</span>

		try {
<span class="fc" id="L67">			allQuestions = quesService.getAllQuestions(qIds, status);</span>

<span class="fc bfc" id="L69" title="All 2 branches covered.">			for (Question question : allQuestions) {</span>
<span class="fc" id="L70">				question.add(linkTo(methodOn(QuestionRestController.class)</span>
<span class="fc" id="L71">						.getQuestions(String.valueOf(question.getQuestionId()), status)).withSelfRel());</span>
<span class="fc" id="L72">			}</span>

<span class="fc" id="L74">			Link link = linkTo(methodOn(QuestionRestController.class).getQuestions(qIds, status)).withSelfRel();</span>
<span class="fc" id="L75">			CollectionModel&lt;Question&gt; resources = new CollectionModel&lt;Question&gt;(allQuestions, link);</span>
<span class="fc" id="L76">			log.info(&quot;GET / returns all the questions&quot;);</span>

<span class="fc" id="L78">			return new ResponseEntity&lt;CollectionModel&lt;Question&gt;&gt;(resources, HttpStatus.OK);</span>
<span class="fc" id="L79">		} catch (Exception e) {</span>
			// TODO Auto-generated catch block
<span class="fc" id="L81">			log.error(&quot;feedbackService QuestionRestController Error in retrieving questions &quot;, e);</span>
<span class="fc" id="L82">			return new ResponseEntity&lt;CollectionModel&lt;Question&gt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR);</span>
		}
	}

	/**
	 * This method is used to fetch question for questionId
	 *
	 * @param qId
	 * @return ResponseEntity&lt;Question&gt;
	 * @throws BaseApplicationException
	 */
	@RequestMapping(value = &quot;/{qId}&quot;, method = RequestMethod.GET)
	@Operation(description = &quot;Fetch question for questionId provided&quot;)
	@Parameters({ @Parameter(name = &quot;qId&quot;, description = &quot;Provide the questionId&quot;, in = ParameterIn.PATH) })
	public ResponseEntity&lt;Question&gt; getQuestionById(@PathVariable Long qId) throws BaseApplicationException {

		try {
<span class="fc" id="L99">			Question ques = quesService.getQuestion(qId);</span>
<span class="pc bpc" id="L100" title="1 of 2 branches missed.">			if (ques != null) {</span>
<span class="fc" id="L101">				ques.add(linkTo(methodOn(QuestionRestController.class).getQuestionById(qId)).withSelfRel());</span>
			}
			// else{
			// throw new BaseApplicationException(&quot;Record for questionID &quot; + qId
			// + &quot; is not available&quot;);
			// }

<span class="fc" id="L108">			log.info(&quot;GET /&quot; + qId + &quot; return detail of the following id &quot; + qId);</span>
<span class="fc" id="L109">			return new ResponseEntity&lt;Question&gt;(ques, HttpStatus.OK);</span>
<span class="fc" id="L110">		} catch (Exception e) {</span>
			// TODO Auto-generated catch block
<span class="fc" id="L112">			log.error(&quot;FeedService - Error in retriving question details &quot;, e);</span>
<span class="fc" id="L113">			return new ResponseEntity&lt;Question&gt;(HttpStatus.INTERNAL_SERVER_ERROR);</span>
		}
	}

	/**
	 * This method is used to add question to database
	 * 
	 * @param question
	 * @return ResponseEntity&lt;Question&gt;
	 * @throws BaseApplicationException
	 */
	@RequestMapping(method = RequestMethod.POST)
	@Operation(description = &quot;Create Question&quot;)
	public ResponseEntity&lt;Question&gt; createQuestion(@RequestBody Question question) throws BaseApplicationException {
		try {
<span class="fc" id="L128">			Question savedQuestion = quesService.createQuestion(question);</span>
<span class="fc" id="L129">			log.info(&quot;/POST Question was successfully added &quot; + savedQuestion.getQuestionId());</span>
<span class="fc" id="L130">			return new ResponseEntity&lt;Question&gt;(savedQuestion, HttpStatus.CREATED);</span>
<span class="fc" id="L131">		} catch (Exception e) {</span>
<span class="fc" id="L132">			log.error(&quot;Error while Posting the question &quot;, e);</span>
<span class="fc" id="L133">			return new ResponseEntity&lt;Question&gt;(HttpStatus.INTERNAL_SERVER_ERROR);</span>
		}
	}

	/**
	 * This method is used to update questionId
	 * 
	 * @param questionId
	 * @param question
	 * @return ResponseEntity&lt;Question&gt;
	 * @throws BaseApplicationException
	 */
	@RequestMapping(method = RequestMethod.PUT)
	@Operation(description = &quot;Update Question&quot;)
	public ResponseEntity&lt;Question&gt; updateQuestion(@RequestBody Question question) throws BaseApplicationException {
		try {
<span class="fc" id="L149">			Question savedQuestion = quesService.updateQuestion(question);</span>
<span class="fc" id="L150">			log.info(&quot;/PUT Question was successfully updated &quot; + question.getQuestionId());</span>
<span class="fc" id="L151">			return new ResponseEntity&lt;Question&gt;(savedQuestion, HttpStatus.CREATED);</span>
<span class="fc" id="L152">		} catch (Exception e) {</span>
<span class="fc" id="L153">			log.error(&quot;Error in Updating the question &quot;, e);</span>
<span class="fc" id="L154">			return new ResponseEntity&lt;Question&gt;(HttpStatus.INTERNAL_SERVER_ERROR);</span>
		}
	}

	/**
	 * This method is used to Delete Question
	 * 
	 * @param questionId
	 * @return ResponseEntity
	 */
	@RequestMapping(value = &quot;/{questionId}&quot;, method = RequestMethod.DELETE)
	@Operation(description = &quot;Delete Question&quot;)
	public ResponseEntity&lt;Object&gt; deleteQuestion(@PathVariable Long questionId) {
		try {
<span class="fc" id="L168">			String status = quesService.deleteQuestion(questionId);</span>
<span class="fc bfc" id="L169" title="All 2 branches covered.">			if ((&quot;Successful&quot;).equalsIgnoreCase(status)) {</span>
<span class="fc" id="L170">				log.info(&quot;/Delete successfully deleted question Id &quot; + questionId);</span>
			} else {
<span class="fc" id="L172">				log.info(&quot;/Delete the question wasnt present&quot;);</span>
<span class="fc" id="L173">				return new ResponseEntity&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR);</span>
			}
<span class="fc" id="L175">			return new ResponseEntity&lt;&gt;(HttpStatus.OK);</span>
<span class="fc" id="L176">		} catch (Exception e) {</span>
<span class="fc" id="L177">			log.error(&quot;Error in deleting the question &quot; + e);</span>
<span class="fc" id="L178">			return new ResponseEntity&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR);</span>
		}
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>